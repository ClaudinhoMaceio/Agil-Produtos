<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo Digital - Agil Produtos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .product-card:hover { transform: translateY(-5px); transition: all 0.3s ease; }
        .cart-badge { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .bg-agil { background-color: #a4d4cc; } 
        .text-agil { color: #1a1a1a; }
        /* Fallback para imagens n√£o encontradas */
        img { background-color: #f3f4f6; position: relative; }
        img:after { 
            content: "Imagem n√£o encontrada"; 
            display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: #eee; font-size: 10px; color: #888; display: flex; align-items: center; justify-content: center; text-align: center;
        }
        /* Estilos para o modal de imagem */
        #image-modal {
            animation: fadeIn 0.3s ease;
        }
        #image-modal.hidden {
            display: none !important;
        }
        #modal-image {
            animation: zoomIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        /* Melhor visualiza√ß√£o das imagens */
        .product-card img {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .product-card:hover img {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <!-- Header / Banner -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <!-- Logo do sistema -->
                <img src="IMAGENS/logo.jpeg" alt="Agil Produtos Logo" class="h-12 w-12 rounded-full object-cover border-2 border-agil shadow-sm">
                <div>
                    <h1 class="font-bold text-xl leading-none uppercase">Agil Produtos</h1>
                    <p class="text-xs text-gray-500 uppercase tracking-widest">Agilidade e Praticidade</p>
                </div>
            </div>
            <button onclick="toggleCart()" class="relative p-2 text-gray-700 hover:text-agil transition-colors">
                <i class="fa-solid fa-cart-shopping text-2xl"></i>
                <span id="cart-count" class="cart-badge hidden">0</span>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-agil py-8 px-4 mb-8">
        <div class="container mx-auto text-center">
            <h2 class="text-2xl md:text-3xl font-bold mb-2">Seu Pedido em um Clique</h2>
            <p class="text-gray-700">Qualidade Point Clean e Fab Limp direto para voc√™.</p>
        </div>
    </section>

    <!-- Search/Filter -->
    <div class="container mx-auto px-4 mb-8">
        <div class="relative max-w-xl mx-auto">
            <input type="text" id="searchInput" placeholder="Buscar por categoria..." onkeyup="filterProducts()" class="w-full p-4 pl-12 rounded-2xl border-0 shadow-md focus:outline-none focus:ring-2 focus:ring-agil">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-5 text-gray-400"></i>
        </div>
        <div class="text-center mt-4">
            <button onclick="reloadProducts()" class="text-xs text-gray-500 hover:text-agil flex items-center gap-2 mx-auto">
                <i class="fa-solid fa-arrow-rotate-right"></i>
                <span>Recarregar Produtos</span>
            </button>
        </div>
    </div>

    <!-- Product Grid -->
    <main class="container mx-auto px-4 pb-20">
        <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
            <!-- Os produtos ser√£o inseridos via JavaScript -->
        </div>
    </main>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar" class="fixed inset-y-0 right-0 w-full md:w-96 bg-white shadow-2xl z-[60] transform translate-x-full transition-transform duration-300 ease-in-out">
        <div class="flex flex-col h-full">
            <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-lg flex items-center gap-2">
                    <i class="fa-solid fa-basket-shopping text-agil"></i>
                    Meu Pedido
                </h3>
                <button onclick="toggleCart()" class="p-2 hover:bg-gray-200 rounded-full transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <div id="cart-items" class="flex-grow overflow-y-auto p-4 space-y-4">
                <p id="empty-cart-msg" class="text-center text-gray-500 mt-10 italic">Seu carrinho est√° vazio.</p>
            </div>

            <div class="p-6 border-t bg-gray-50">
                <div class="flex justify-between mb-4 font-bold text-lg">
                    <span>Total de Itens:</span>
                    <span id="cart-total-items">0</span>
                </div>
                <button onclick="sendToWhatsApp()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-2xl flex items-center justify-center gap-3 shadow-lg shadow-green-200 transition-all active:scale-95">
                    <i class="fa-brands fa-whatsapp text-2xl"></i>
                    FINALIZAR NO WHATSAPP
                </button>
                <div class="mt-6 text-center">
                    <p class="text-[10px] text-gray-400 uppercase font-bold tracking-widest">Agil Produtos de Limpeza</p>
                    <p class="text-[9px] text-gray-400 mt-1">CNPJ: 61.860.559/0001-86</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" onclick="toggleCart()" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-[55] hidden"></div>

    <!-- Modal de Imagem Ampliada -->
    <div id="image-modal" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[80] hidden flex items-center justify-center p-4" onclick="closeImageModal()">
        <div class="relative max-w-7xl max-h-[95vh] w-full h-full flex items-center justify-center" onclick="event.stopPropagation()">
            <button onclick="closeImageModal()" class="absolute top-4 right-4 z-10 bg-white/90 hover:bg-white text-gray-800 p-3 rounded-full shadow-lg transition-all">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            <img id="modal-image" src="" alt="Imagem ampliada" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl">
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o com Miniaturas -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[70] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50">
                <h3 class="font-bold text-xl flex items-center gap-2">
                    <i class="fa-solid fa-images text-agil"></i>
                    Confirmar Pedido
                </h3>
                <button onclick="closeConfirmModal()" class="p-2 hover:bg-gray-200 rounded-full transition-colors">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            
            <div class="flex-grow overflow-y-auto p-6">
                <p class="text-sm text-gray-600 mb-4">Seu pedido cont√©m os seguintes produtos:</p>
                <div id="confirm-items" class="grid grid-cols-3 md:grid-cols-4 gap-3 mb-4">
                    <!-- Miniaturas ser√£o inseridas aqui -->
                </div>
                <div class="mt-4 p-4 bg-gray-50 rounded-xl">
                    <p class="text-center font-bold text-lg">
                        Total: <span id="confirm-total">0</span> itens
                    </p>
                </div>
            </div>

            <div class="p-6 border-t bg-gray-50 flex gap-3">
                <button onclick="closeConfirmModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 rounded-xl transition-colors">
                    Cancelar
                </button>
                <button onclick="confirmSendToWhatsApp()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-green-200 transition-all">
                    <i class="fa-brands fa-whatsapp text-xl"></i>
                    Enviar no WhatsApp
                </button>
            </div>
        </div>
    </div>

    <script>
        // PRODUTOS AGORA S√ÉO CARREGADOS DO ARQUIVO produtos.json
        // Para editar os nomes dos produtos, abra o arquivo produtos.json e altere o campo "name"
        let products = [];
        let cart = [];

        // Carrega os produtos do arquivo JSON
        async function loadProducts() {
            try {
                // Adiciona timestamp para evitar cache
                const timestamp = new Date().getTime();
                const response = await fetch(`produtos.json?t=${timestamp}`);
                if (!response.ok) throw new Error('Erro ao carregar JSON');
                const data = await response.json();
                if (data && Array.isArray(data) && data.length > 0) {
                    products = data;
                    console.log(`‚úÖ Carregados ${products.length} produtos do JSON`);
                    
                    // Normaliza os caminhos das imagens
                    products.forEach(product => {
                        // Garante que o caminho est√° correto
                        if (product.image && !product.image.startsWith('http')) {
                            // Remove barras duplicadas e normaliza
                            product.image = product.image.replace(/\\/g, '/').replace(/\/+/g, '/');
                            // Se n√£o come√ßar com ./ ou IMAGENS/, adiciona
                            if (!product.image.startsWith('./') && !product.image.startsWith('IMAGENS/')) {
                                if (!product.image.includes('IMAGENS')) {
                                    product.image = 'IMAGENS/' + product.image;
                                }
                            }
                        }
                    });
                    
                    renderProducts();
                } else {
                    console.warn('JSON vazio ou inv√°lido, usando produtos padr√£o');
                    loadDefaultProducts();
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar produtos.json:', error);
                console.log('Tentando usar produtos padr√£o...');
                loadDefaultProducts();
            }
        }

        // Fun√ß√£o para recarregar produtos manualmente (acess√≠vel globalmente)
        window.reloadProducts = function() {
            console.log('üîÑ Recarregando produtos...');
            const btn = event?.target || document.querySelector('button[onclick="reloadProducts()"]');
            if (btn) {
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> <span>Carregando...</span>';
                btn.disabled = true;
            }
            loadProducts().then(() => {
                if (btn) {
                    btn.innerHTML = '<i class="fa-solid fa-arrow-rotate-right"></i> <span>Recarregar Produtos</span>';
                    btn.disabled = false;
                }
            });
        };

        // Carrega produtos padr√£o (fallback)
        function loadDefaultProducts() {
            products = [
                { id: 1, name: "Sab√£o em Pasta Fab Limp 500g", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.48.jpeg" },
                { id: 2, name: "Limpador Perfumado Point 2L", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.49 (1).jpeg" },
                { id: 3, name: "√Ågua Sanit√°ria Point 2L", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.49.jpeg" },
                { id: 4, name: "Cloro Concentrado Point 2L", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.50.jpeg" },
                { id: 5, name: "Detergente Lava Lou√ßas 2L", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.51 (1).jpeg" },
                { id: 6, name: "Lava Carros Point 2L", category: "Automotivo", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.51 (2).jpeg" },
                { id: 7, name: "Spray Mop Completo", category: "Utens√≠lios", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.51 (3).jpeg" },
                { id: 8, name: "Varal de Ch√£o Refor√ßado", category: "Utens√≠lios", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.51.jpeg" },
                { id: 9, name: "Desengraxante Industrial 2L", category: "Limpeza Pesada", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.52.jpeg" },
                { id: 10, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.53 (1).jpeg" },
                { id: 11, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.53 (2).jpeg" },
                { id: 12, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.53.jpeg" },
                { id: 13, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.54.jpeg" },
                { id: 14, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.55.jpeg" },
                { id: 15, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.56 (1).jpeg" },
                { id: 16, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.56 (2).jpeg" },
                { id: 17, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.56.jpeg" },
                { id: 18, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.57 (1).jpeg" },
                { id: 19, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.57.jpeg" },
                { id: 20, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.58 (1).jpeg" },
                { id: 21, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.58 (2).jpeg" },
                { id: 22, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.58 (3).jpeg" },
                { id: 23, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.58.jpeg" },
                { id: 24, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.59 (1).jpeg" },
                { id: 25, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.59 (2).jpeg" },
                { id: 26, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.14.59.jpeg" },
                { id: 27, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.00 (1).jpeg" },
                { id: 28, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.00 (2).jpeg" },
                { id: 29, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.00.jpeg" },
                { id: 30, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.01 (1).jpeg" },
                { id: 31, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.01 (2).jpeg" },
                { id: 32, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.01 (3).jpeg" },
                { id: 33, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.01.jpeg" },
                { id: 34, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.02 (1).jpeg" },
                { id: 35, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.02 (2).jpeg" },
                { id: 36, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.02 (3).jpeg" },
                { id: 37, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.02 (4).jpeg" },
                { id: 38, name: "Produto de Limpeza", category: "Limpeza", image: "IMAGENS/WhatsApp Image 2026-02-23 at 13.15.02.jpeg" }
            ];
            renderProducts();
        }

        // Fun√ß√£o para codificar caminho de imagem corretamente
        function encodeImagePath(imagePath) {
            if (!imagePath) return '';
            const parts = imagePath.split('/');
            const fileName = parts.pop();
            const encodedFileName = encodeURIComponent(fileName);
            return parts.join('/') + '/' + encodedFileName;
        }

        function renderProducts() {
            const grid = document.getElementById('product-grid');
            if (!grid) {
                console.error('Elemento product-grid n√£o encontrado!');
                return;
            }
            if (!products || products.length === 0) {
                console.warn('Nenhum produto para exibir!');
                grid.innerHTML = '<div class="col-span-full text-center py-20"><p class="text-gray-500">Nenhum produto encontrado.</p></div>';
                return;
            }
            grid.innerHTML = products.map(product => {
                const imageSrc = encodeImagePath(product.image);
                const safeImageSrc = imageSrc.replace(/'/g, "\\'");
                return `
                <div class="product-card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden flex flex-col">
                    <div class="relative h-64 overflow-hidden bg-gray-100 cursor-pointer group" onclick="openImageModal('${safeImageSrc}')">
                        <img src="${imageSrc}" alt="${product.name || 'Produto'}" 
                             class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                             loading="lazy"
                             onerror="console.error('Erro ao carregar imagem:', '${safeImageSrc}'); this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'400\'%3E%3Crect fill=\'%23f3f4f6\' width=\'400\' height=\'400\'/%3E%3Ctext fill=\'%239ca3af\' font-family=\'sans-serif\' font-size=\'18\' dy=\'10.5\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\'%3EImagem n√£o encontrada%3C/text%3E%3C/svg%3E';">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                            <i class="fa-solid fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                        </div>
                    </div>
                    <div class="p-3 flex flex-col flex-grow">
                        <h3 class="text-sm font-semibold text-gray-800 mb-2 line-clamp-2 min-h-[2.5rem]">${product.name || 'Produto'}</h3>
                        <div class="mt-auto">
                            <button onclick="addToCart(${product.id})" class="w-full bg-gray-900 text-white py-2.5 rounded-xl text-[11px] font-bold hover:bg-agil hover:text-gray-900 transition-all flex items-center justify-center gap-2">
                                <i class="fa-solid fa-cart-plus"></i> ADICIONAR
                            </button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            const inCart = cart.find(item => item.id === productId);

            if (inCart) {
                inCart.quantity++;
            } else {
                cart.push({ ...product, quantity: 1 });
            }
            updateCartUI();
            
            const btn = event.currentTarget;
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check"></i> NO CARRINHO';
            btn.style.backgroundColor = '#a4d4cc';
            btn.style.color = '#111';
            
            setTimeout(() => {
                btn.innerHTML = originalContent;
                btn.style.backgroundColor = '';
                btn.style.color = '';
            }, 1200);
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const totalItemsText = document.getElementById('cart-total-items');
            const emptyMsg = document.getElementById('empty-cart-msg');

            const totalCount = cart.reduce((sum, item) => sum + item.quantity, 0);
            
            if (totalCount > 0) {
                cartCount.innerText = totalCount;
                cartCount.classList.remove('hidden');
                emptyMsg?.classList.add('hidden');
            } else {
                cartCount.classList.add('hidden');
                emptyMsg?.classList.remove('hidden');
            }

            totalItemsText.innerText = totalCount;

            if (cart.length === 0) {
                cartItems.innerHTML = '<p id="empty-cart-msg" class="text-center text-gray-500 mt-10 italic">Seu carrinho est√° vazio.</p>';
            } else {
                cartItems.innerHTML = cart.map(item => {
                    const itemImageSrc = encodeImagePath(item.image);
                    return `
                    <div class="flex items-center gap-3 bg-white p-3 rounded-2xl border border-gray-100 shadow-sm">
                        <img src="${itemImageSrc}" alt="${item.name || 'Produto'}" 
                             class="w-16 h-16 rounded-xl object-cover bg-gray-50"
                             onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'64\' height=\'64\'%3E%3Crect fill=\'%23f3f4f6\' width=\'64\' height=\'64\'/%3E%3Ctext fill=\'%239ca3af\' font-family=\'sans-serif\' font-size=\'10\' dy=\'10.5\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\'%3E?%3C/text%3E%3C/svg%3E';">
                        <div class="flex-grow">
                            <p class="text-xs font-semibold text-gray-800 mb-1 line-clamp-1">${item.name || 'Produto'}</p>
                            <div class="flex items-center gap-4">
                                <div class="flex items-center bg-gray-100 rounded-lg p-1">
                                    <button onclick="changeQty(${item.id}, -1)" class="w-6 h-6 flex items-center justify-center font-bold">-</button>
                                    <span class="w-8 text-center text-xs font-bold">${item.quantity}</span>
                                    <button onclick="changeQty(${item.id}, 1)" class="w-6 h-6 flex items-center justify-center font-bold">+</button>
                                </div>
                                <button onclick="removeItem(${item.id})" class="text-red-400 text-xs flex items-center gap-1">
                                    <i class="fa-solid fa-trash-can"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
            }
        }

        function changeQty(id, delta) {
            const item = cart.find(i => i.id === id);
            item.quantity += delta;
            if (item.quantity <= 0) {
                removeItem(id);
            } else {
                updateCartUI();
            }
        }

        function removeItem(id) {
            cart = cart.filter(i => i.id !== id);
            updateCartUI();
        }

        function toggleCart() {
            document.getElementById('cart-sidebar').classList.toggle('translate-x-full');
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function openImageModal(imageSrc) {
            const modal = document.getElementById('image-modal');
            const modalImage = document.getElementById('modal-image');
            modalImage.src = imageSrc;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeImageModal() {
            const modal = document.getElementById('image-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // Fecha modal com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeImageModal();
            }
        });

        function filterProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            // Filtra por categoria ou nome (mesmo que n√£o mostre o nome)
            const filtered = products.filter(p => 
                (p.name && p.name.toLowerCase().includes(query)) || 
                (p.category && p.category.toLowerCase().includes(query))
            );
            
            const grid = document.getElementById('product-grid');
            if(filtered.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20">
                        <i class="fa-solid fa-box-open text-4xl text-gray-200 mb-4"></i>
                        <p class="text-gray-500">Nenhum produto encontrado...</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filtered.map(product => {
                const imageSrc = encodeImagePath(product.image);
                const safeImageSrc = imageSrc.replace(/'/g, "\\'");
                return `
                <div class="product-card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden flex flex-col">
                    <div class="relative h-64 overflow-hidden bg-gray-100 cursor-pointer group" onclick="openImageModal('${safeImageSrc}')">
                        <img src="${imageSrc}" alt="${product.name || 'Produto'}" 
                             class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                             loading="lazy"
                             onerror="console.error('Erro ao carregar imagem:', '${safeImageSrc}'); this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'400\'%3E%3Crect fill=\'%23f3f4f6\' width=\'400\' height=\'400\'/%3E%3Ctext fill=\'%239ca3af\' font-family=\'sans-serif\' font-size=\'18\' dy=\'10.5\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\'%3EImagem n√£o encontrada%3C/text%3E%3C/svg%3E';">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                            <i class="fa-solid fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-2xl"></i>
                        </div>
                    </div>
                    <div class="p-3 flex flex-col flex-grow">
                        <h3 class="text-sm font-semibold text-gray-800 mb-2 line-clamp-2 min-h-[2.5rem]">${product.name || 'Produto'}</h3>
                        <div class="mt-auto">
                            <button onclick="addToCart(${product.id})" class="w-full bg-gray-900 text-white py-2.5 rounded-xl text-[11px] font-bold hover:bg-agil hover:text-gray-900 transition-all flex items-center justify-center gap-2">
                                <i class="fa-solid fa-cart-plus"></i> ADICIONAR
                            </button>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
        }

        function sendToWhatsApp() {
            if (cart.length === 0) {
                alert("Seu carrinho est√° vazio!");
                return;
            }

            // Mostra modal de confirma√ß√£o com miniaturas
            showConfirmModal();
        }

        function showConfirmModal() {
            const modal = document.getElementById('confirm-modal');
            const confirmItems = document.getElementById('confirm-items');
            const confirmTotal = document.getElementById('confirm-total');
            
            // Limpa e preenche miniaturas
            let allItems = [];
            cart.forEach(item => {
                for (let i = 0; i < item.quantity; i++) {
                    allItems.push(item.image);
                }
            });
            
            confirmItems.innerHTML = allItems.map(image => {
                const confirmImageSrc = encodeImagePath(image);
                return `
                <div class="relative group">
                    <img src="${confirmImageSrc}" class="w-full aspect-square rounded-lg object-cover border-2 border-gray-200 shadow-sm"
                         onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'%3E%3Crect fill=\'%23f3f4f6\' width=\'100\' height=\'100\'/%3E%3Ctext fill=\'%239ca3af\' font-family=\'sans-serif\' font-size=\'10\' dy=\'10.5\' font-weight=\'bold\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\'%3E?%3C/text%3E%3C/svg%3E';">
                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 rounded-lg transition-colors"></div>
                </div>
            `;
            }).join('');
            
            confirmTotal.innerText = cart.reduce((sum, i) => sum + i.quantity, 0);
            modal.classList.remove('hidden');
        }

        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.add('hidden');
        }

        function confirmSendToWhatsApp() {
            const phone = "5511960435545"; 
            let message = "*NOVO PEDIDO - AGIL PRODUTOS*\n";
            message += "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n";
            message += "Ol√°! Gostaria de encomendar os seguintes produtos:\n\n";

            cart.forEach((item, index) => {
                message += `üì¶ *${item.quantity}x* ${item.name || `Produto ${index + 1}`}\n`;
            });

            message += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            message += `*Total de Itens:* ${cart.reduce((sum, i) => sum + i.quantity, 0)}\n\n`;
            message += "As imagens dos produtos est√£o vis√≠veis no cat√°logo.\n\n";
            message += "Qual o valor total e o prazo de entrega para o meu endere√ßo?";

            const encodedMessage = encodeURIComponent(message);
            closeConfirmModal();
            window.open(`https://wa.me/${phone}?text=${encodedMessage}`, '_blank');
        }

        window.onload = loadProducts;
    </script>
</body>
</html>
